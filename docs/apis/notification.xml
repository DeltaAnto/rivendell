<?xml version="1.0" encoding="ISO-8859-1"?>
<article xmlns="http://docbook.org/ns/docbook" version="5.0">
<info>
  <title>Rivendell Notification Protocol</title>
  <author>
    <personname>
      <firstname>Fred</firstname>
      <surname>Gleason</surname>
      <email>fredg@paravelsystems.com</email>
    </personname>
  </author>
</info>

<sect1 xml:id="overview">
  <title>Overview</title>
  <para>
    This defines the IP protocol used to notify Rivendell components of
    changes to the state of database objects. Messages are send by means
    of multicast UDP packets to port 20539.
  </para>
  <para>
    The format of a message is as follows:
  </para>
  <para>
    NOTIFY <replaceable choice='req'>obj-type-id</replaceable>
    <replaceable choice='req'>action</replaceable>
    <replaceable choice='req'>id0</replaceable>
    <replaceable choice='opt'>id1</replaceable>
    <replaceable choice='opt'>...</replaceable>
  </para>
  <variablelist>
    <varlistentry>
      <term>
	<replaceable>obj-type-id</replaceable>
      </term>
      <listitem>
	<para>
	  The object type to which the message pertains.
	</para>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>
	<replaceable>action</replaceable>
      </term>
      <listitem>
	<para>
	  The action being reported. The following actions are defined:
	</para>
	<variablelist>
	  <varlistentry>
	    <term>
	      ADD
	    </term>
	    <listitem>
	      <para>
		The referenced object has just been added to the database.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term>
	      DELETE
	    </term>
	    <listitem>
	      <para>
		The referenced object has just been deleted from the database.
	      </para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term>
	      MODIFY
	    </term>
	    <listitem>
	      <para>
		The reference object has just been modified in the database.
	      </para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </listitem>
    </varlistentry>
    <varlistentry>
      <term>
	<replaceable>id&lt;n&gt;</replaceable>
      </term>
      <listitem>
	<para>
	  One or more fields constituting the unique id of the object.
	  Space characters [ASCII 32] should be escaped by pre-pending an
	  backslash character [ASCII 134].
	</para>
      </listitem>
    </varlistentry>
  </variablelist>
</sect1>

<sect1 xml:id="sect.object_types">
  <title>Object Types</title>
  <para>
    The following object types are defined:
  </para>
  <sect2 xml:id="sect.object_types.cart">
    <title>Carts</title>
    <table xml:id="table.object_types.carts" frame="all" pgwide="0">
      <title>Cart Fields</title>
      <tgroup cols="2" align="left" colsep="1" rowsep="1">
	<colspec colname="Field" colwidth="2.0*"/>
	<colspec colname="Value" colwidth="10.0*"/>
	<tbody>
	  <row><entry>Field</entry><entry>Value</entry></row>
	  <row><entry>obj-type-id</entry><entry>CART</entry></row>
	  <row><entry>id[0]</entry><entry>Cart number</entry></row>
	  <row><entry>id[0] format</entry><entry>Unsigned Integer [CART.NUMBER]</entry></row>
	</tbody>
      </tgroup>
    </table>
  </sect2>

  <sect2 xml:id="sect.object_types.log">
    <title>Logs</title>
    <table xml:id="table.object_types.logs" frame="all" pgwide="0">
      <title>Log Fields</title>
      <tgroup cols="2" align="left" colsep="1" rowsep="1">
	<colspec colname="Field" colwidth="2.0*"/>
	<colspec colname="Value" colwidth="10.0*"/>
	<tbody>
	  <row><entry>Field</entry><entry>Value</entry></row>
	  <row><entry>obj-type-id</entry><entry>LOG</entry></row>
	  <row><entry>id[0]</entry><entry>Log name</entry></row>
	  <row><entry>id[0] format</entry><entry>String [LOGS.NAME]</entry></row>
	</tbody>
      </tgroup>
    </table>
  </sect2>

  <sect2 xml:id="sect.object_types.pypad">
    <title>PyPAD Instances</title>
    <table xml:id="table.object_types.pypad" frame="all" pgwide="0">
      <title>PyPAD Instance Fields</title>
      <tgroup cols="2" align="left" colsep="1" rowsep="1">
	<colspec colname="Field" colwidth="2.0*"/>
	<colspec colname="Value" colwidth="10.0*"/>
	<tbody>
	  <row><entry>Field</entry><entry>Value</entry></row>
	  <row><entry>obj-type-id</entry><entry>PYPAD</entry></row>
	  <row><entry>id[0]</entry><entry>PyPAD Instance ID</entry></row>
	  <row><entry>id[0] format</entry><entry>Unsigned Integer [PYPAD_INSTANCES.ID]</entry></row>
	</tbody>
      </tgroup>
    </table>
  </sect2>

  <sect2 xml:id="sect.object_types.dropbox">
    <title>Dropbox Restarts</title>
    <table xml:id="table.object_types.dropbox" frame="all" pgwide="0">
      <title>Dropbox Restarts Fields</title>
      <tgroup cols="2" align="left" colsep="1" rowsep="1">
	<colspec colname="Field" colwidth="2.0*"/>
	<colspec colname="Value" colwidth="10.0*"/>
	<tbody>
	  <row><entry>Field</entry><entry>Value</entry></row>
	  <row><entry>obj-type-id</entry><entry>DROPBOX</entry></row>
	  <row><entry>id[0]</entry><entry>Dropbox Hostname</entry></row>
	  <row><entry>id[0] format</entry><entry>String[DROPBOXES.STATION_NAME]</entry></row>
	</tbody>
      </tgroup>
    </table>
  </sect2>

  <sect2 xml:id="sect.object_types.heartbeat">
    <title>Host Online Status</title>
    <table xml:id="table.object_types.heartbeat" frame="all" pgwide="0">
      <title>Host Online Status Fields</title>
      <tgroup cols="2" align="left" colsep="1" rowsep="1">
	<colspec colname="Field" colwidth="2.0*"/>
	<colspec colname="Value" colwidth="10.0*"/>
	<tbody>
	  <row><entry>Field</entry><entry>Value</entry></row>
	  <row><entry>obj-type-id</entry><entry>HEARTBEAT</entry></row>
	  <row><entry>id[0]</entry><entry>Rivendell Hostname</entry></row>
	  <row><entry>id[0] format</entry><entry>String[STATIONS.NAME]</entry></row>
	</tbody>
      </tgroup>
    </table>
  </sect2>

  <sect2 xml:id="sect.object_types.rdcatch_deck_status">
    <title>RDCatch Deck Status</title>
    <table xml:id="table.object_types.rdcatch_deck_status" frame="all" pgwide="0">
      <title>RDCatch Deck Status Fields</title>
      <tgroup cols="2" align="left" colsep="1" rowsep="1">
	<colspec colname="Field" colwidth="2.0*"/>
	<colspec colname="Value" colwidth="10.0*"/>
	<tbody>
	  <row><entry>Field</entry><entry>Value</entry></row>
	  <row><entry>obj-type-id</entry><entry>CATCH_EVENT</entry></row>
	  <row><entry>id[0]</entry><entry>Rivendell Hostname</entry></row>
	  <row><entry>id[0] format</entry><entry>String [DECKS.STATION_NAME]</entry></row>
	  <row><entry>id[1]</entry><entry>Current Event ID</entry></row>
	  <row><entry>id[1] format</entry><entry>Unsigned Integer [DECKS.RECORDING_ID]</entry></row>
	  <row><entry>id[2]</entry><entry>Current Event Description</entry></row>
	  <row><entry>id[2] format</entry><entry>String [RECORDING.DESCRIPTION]</entry></row>
	</tbody>
      </tgroup>
    </table>
  </sect2>

</sect1>

</article>
